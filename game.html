<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YDS Wars - Köy Görünümü</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f6f8; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; user-select: none; }
        
        /* --- ÜST BAR (KAYNAKLAR VE ALTIN) --- */
        .top-bar { background-color: #ffffff; border-bottom: 3px solid #b8860b; padding: 8px 0; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .res-box { display: flex; align-items: center; gap: 5px; font-weight: bold; font-size: 1.1rem; border-right: 1px solid #ddd; padding-right: 15px; }
        .gold-text { color: #d4af37; font-weight: 900; font-size: 1.2rem; text-shadow: 1px 1px 0 #000; }

        /* --- KÖY HARİTASI (DORF 1 & DORF 2) --- */
        .map-container {
            width: 600px; height: 600px; margin: 0 auto; position: relative;
            background: radial-gradient(circle, #8bc34a 30%, #558b2f 100%);
            border-radius: 50%; border: 8px solid #33691e; box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .map-container.dorf2 {
            background: radial-gradient(circle, #dcedc8 20%, #aed581 80%);
        }
        
        /* Ortadaki Nehir Efekti (Sadece Görsel) */
        .river { position: absolute; background: #4fc3f7; width: 100%; height: 40px; top: 50%; transform: translateY(-50%) rotate(15deg); opacity: 0.5; }

        /* --- TIKLANABİLİR YUVARLAKLAR (SLOTLAR) --- */
        .slot {
            position: absolute; width: 44px; height: 44px; border-radius: 50%;
            background: white; border: 3px solid #333; 
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 0.9rem; cursor: pointer;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.5); transition: 0.2s; z-index: 10;
        }
        .slot:hover { transform: scale(1.2); box-shadow: 0 0 15px #fff; z-index: 20; }
        .slot.empty { background: rgba(255,255,255,0.6); border-color: #888; color: #555; }
        .slot.empty:hover { background: #f1c40f; border-color: #000; color: #000; }
        
        /* Kaynak Renkleri */
        .wood { border-color: #27ae60; color: #27ae60; background: #e8f8f5; }
        .clay { border-color: #d35400; color: #d35400; background: #fbeee6; }
        .iron { border-color: #7f8c8d; color: #7f8c8d; background: #f2f4f4; }
        .crop { border-color: #f39c12; color: #f39c12; background: #fef9e7; }
        .building { border-color: #2980b9; color: #2980b9; background: #eaf2f8; }
        .main-building { border-color: #8e44ad; color: #8e44ad; width: 60px; height: 60px; font-size: 1.2rem; }

        /* --- SAĞ / SOL MENÜLER --- */
        .side-box { background: white; border: 1px solid #ccc; border-radius: 5px; margin-bottom: 15px; }
        .side-box-header { background: #34495e; color: white; padding: 8px; font-weight: bold; text-align: center; border-radius: 5px 5px 0 0; }
        .side-box-content { padding: 10px; font-size: 0.9rem; }
        
        /* Premium Butonları */
        .premium-btn { width: 100%; text-align: left; margin-bottom: 5px; background: linear-gradient(to bottom, #f1c40f, #f39c12); border: 1px solid #b8860b; font-weight: bold; }
        .premium-btn:hover { background: linear-gradient(to bottom, #f39c12, #e67e22); }
        .premium-btn i { font-size: 1.2rem; margin-right: 5px; }

        /* Kuyruk */
        .q-item { display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding: 5px 0; }
        .q-item.active { color: #2980b9; font-weight: bold; }

        .nav-tabs { border-bottom: 2px solid #34495e; justify-content: center; margin-bottom: 20px;}
        .nav-tabs .nav-link { color: #555; font-weight: bold; font-size: 1.1rem; border: none; }
        .nav-tabs .nav-link.active { color: #fff; background: #34495e; border-radius: 5px 5px 0 0; }
    </style>
</head>
<body>

<!-- Irk Seçim Modalı -->
<div class="modal fade" id="tribeModal" data-bs-backdrop="static" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white"><h5 class="modal-title">Irkını Seç, Köyünü Kur!</h5></div>
            <div class="modal-body text-center">
                <p>Oyun <b>10x Hızında</b> akar. YDS Puanların <b>Altın</b> yerine geçer.</p>
                <div class="d-grid gap-3">
                    <button class="btn btn-outline-danger btn-lg" onclick="selectTribe('Turk')"><b>TÜRKLER</b><br><small>Hızlı atlılar, mükemmel yağma.</small></button>
                    <button class="btn btn-outline-primary btn-lg" onclick="selectTribe('Roman')"><b>ROMALILAR</b><br><small>Aynı anda 1 tarla, 1 bina basabilir.</small></button>
                    <button class="btn btn-outline-success btn-lg" onclick="selectTribe('Teuton')"><b>CERMENLER</b><br><small>Ucuz piyadeler, agresif oyun.</small></button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Yükseltme / Yeni Bina Modalı -->
<div class="modal fade" id="buildModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h5 class="modal-title" id="buildModalTitle">İnşaat</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="buildModalBody">
                <!-- JS İçeriği Buraya Gelecek -->
            </div>
        </div>
    </div>
</div>

<!-- ÜST BAR -->
<div class="top-bar sticky-top">
    <div class="container d-flex justify-content-between align-items-center flex-wrap">
        <div class="d-flex align-items-center gap-3">
            <div class="res-box" title="Odun"><i class="bi bi-tree-fill" style="color:#27ae60;"></i> <span id="res-wood">0</span></div>
            <div class="res-box" title="Tuğla"><i class="bi bi-bricks" style="color:#d35400;"></i> <span id="res-clay">0</span></div>
            <div class="res-box" title="Demir"><i class="bi bi-nut-fill" style="color:#7f8c8d;"></i> <span id="res-iron">0</span></div>
            <div class="res-box" title="Tahıl"><i class="bi bi-flower1" style="color:#f39c12;"></i> <span id="res-crop">0</span> <span class="fs-6 fw-normal text-muted ms-1" id="res-crop-free"></span></div>
        </div>
        <div class="d-flex align-items-center gap-3">
            <div class="gold-text" title="YDS Altını"><i class="bi bi-coin"></i> <span id="gold-amount">0</span> Altın</div>
            <button class="btn btn-sm btn-outline-secondary" onclick="refreshGold()"><i class="bi bi-arrow-clockwise"></i> YDS'den Çek</button>
        </div>
    </div>
</div>

<div class="container mt-3">
    <div class="row">
        <!-- SOL MENÜ (Saatlik Üretim) -->
        <div class="col-md-3">
            <div class="side-box">
                <div class="side-box-header">Köy Profili</div>
                <div class="side-box-content text-center">
                    <h5 class="fw-bold text-primary mb-0" id="tribe-name">-</h5>
                    <small class="text-muted">Nüfus: <b id="population">2</b></small>
                </div>
            </div>

            <div class="side-box">
                <div class="side-box-header">Saatlik Üretim</div>
                <div class="side-box-content fw-bold">
                    <div class="d-flex justify-content-between mb-1"><span style="color:#27ae60;"><i class="bi bi-tree-fill"></i> Odun:</span> <span id="prod-wood">100</span></div>
                    <div class="d-flex justify-content-between mb-1"><span style="color:#d35400;"><i class="bi bi-bricks"></i> Tuğla:</span> <span id="prod-clay">100</span></div>
                    <div class="d-flex justify-content-between mb-1"><span style="color:#7f8c8d;"><i class="bi bi-nut-fill"></i> Demir:</span> <span id="prod-iron">100</span></div>
                    <div class="d-flex justify-content-between"><span style="color:#f39c12;"><i class="bi bi-flower1"></i> Tahıl:</span> <span id="prod-crop">100</span></div>
                </div>
            </div>
            
            <div class="side-box border-warning">
                <div class="side-box-header bg-warning text-dark"><i class="bi bi-star-fill"></i> Premium / Altın</div>
                <div class="side-box-content p-2">
                    <button class="btn premium-btn" onclick="instantFinish()"><i class="bi bi-lightning-charge"></i> Hemen Bitir <span class="badge bg-dark">5</span></button>
                    <button class="btn premium-btn" onclick="npcMerchant()"><i class="bi bi-arrow-left-right"></i> NPC Tüccar <span class="badge bg-dark">3</span></button>
                    <button class="btn premium-btn" onclick="boostProduction()"><i class="bi bi-graph-up-arrow"></i> %25 Üretim <span class="badge bg-dark">10</span></button>
                </div>
            </div>
        </div>

        <!-- OYUN ALANI (Ortası) -->
        <div class="col-md-6">
            <ul class="nav nav-tabs" id="gameTabs">
                <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#dorf1">Kaynaklar (Dorf1)</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#dorf2">Şehir Merkezi (Dorf2)</a></li>
                <li class="nav-item"><a class="nav-link text-success" data-bs-toggle="tab" href="#map"><i class="bi bi-globe"></i> Harita</a></li>
            </ul>

            <div class="tab-content">
                <!-- KAYNAKLAR -->
                <div class="tab-pane fade show active" id="dorf1">
                    <div class="map-container" id="dorf1-map">
                        <!-- Kaynak Yuvarlakları JS ile basılacak -->
                    </div>
                </div>

                <!-- ŞEHİR MERKEZİ -->
                <div class="tab-pane fade" id="dorf2">
                    <div class="map-container dorf2" id="dorf2-map">
                        <!-- Bina Yuvarlakları JS ile basılacak -->
                    </div>
                </div>

                <!-- HARİTA -->
                <div class="tab-pane fade" id="map">
                    <div class="card p-5 text-center mt-5 shadow-sm border-success">
                        <h3 class="text-success"><i class="bi bi-shield-lock-fill"></i> Dünya Haritası</h3>
                        <p class="mt-3"><b>1000 Adet AI Bot</b> ve <b>Gemini Diplomasisi</b> 3. Fazda (Bir sonraki aşama) buraya eklenecek.</p>
                        <p>Köyünü geliştirip asker üretmeye başla, savaş yakında başlıyor!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- SAĞ MENÜ (İnşaat Emirleri) -->
        <div class="col-md-3">
            <div class="side-box border-primary">
                <div class="side-box-header bg-primary"><i class="bi bi-hammer"></i> İnşaat Kuyruğu</div>
                <div class="side-box-content" id="build-queue">
                    <div class="text-muted text-center py-3">Kuyruk boş.</div>
                </div>
            </div>
            
            <div class="side-box">
                <div class="side-box-header bg-danger"><i class="bi bi-shield-sword"></i> Askerler</div>
                <div class="side-box-content text-center py-2">
                    <p class="mb-0 text-muted">Henüz Kışla Yok</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    /* ================= OYUN VERİLERİ VE KOORDİNATLAR ================= */
    
    // Tarlalar (Dorf1) - 4 Odun, 4 Tuğla, 4 Demir, 6 Tahıl
    // Koordinatlar ekranın %'sine göre (left, top)
    const dorf1Layout =;

    // Binalar (Dorf2) - Merkez bina 19, Askeri üs 39, Sur 40
    const dorf2Layout =;

    // Bina Listesi ve Temel Bilgileri
    const buildingInfo = {
        'wood': { name: "Oduncu", cost:, baseProd: 10, time: 20 },
        'clay': { name: "Tuğla Ocağı", cost:, baseProd: 10, time: 20 },
        'iron': { name: "Demir Madeni", cost:, baseProd: 10, time: 20 },
        'crop': { name: "Tarla", cost:, baseProd: 10, time: 20 },
        'center': { name: "Merkez Bina", cost:, time: 30, desc: "Köyün kalbi. İnşaat sürelerini kısaltır." },
        'warehouse': { name: "Depo", cost:, time: 40, desc: "Hammadde kapasitesini artırır." },
        'granary': { name: "Tahıl Ambarı", cost:, time: 32, desc: "Tahıl kapasitesini artırır." },
        'barracks': { name: "Kışla", cost:, time: 50, desc: "Piyade asker eğitilir." },
        'rally': { name: "Askeri Üs", cost:, time: 13, desc: "Askerleri yönlendirir." }
    };

    /* ================= MOTOR ================= */
    let gameState = JSON.parse(localStorage.getItem('yds_game_state')) || null;
    let ydsGold = parseInt(localStorage.getItem('yds_game_gold')) || 0;
    let gameLoop;
    let selectedSlotId = null;

    window.onload = function() {
        refreshGold();
        if (!gameState) {
            new bootstrap.Modal(document.getElementById('tribeModal')).show();
        } else {
            initGame();
        }
    };

    function selectTribe(tribe) {
        gameState = {
            tribe: tribe, population: 2,
            resources: { wood: 800, clay: 800, iron: 800, crop: 800 },
            prodBoostUntil: 0,
            fields: dorf1Layout.map(f => ({ id: f.id, type: f.type, level: 0 })),
            buildings: dorf2Layout.map(b => ({ id: b.id, type: b.type, level: b.isMain ? 1 : 0 })),
            buildQueue:[],
            lastUpdate: Date.now()
        };
        saveState();
        bootstrap.Modal.getInstance(document.getElementById('tribeModal')).hide();
        initGame();
    }

    function initGame() {
        document.getElementById('tribe-name').innerText = gameState.tribe === 'Turk' ? 'Türkler' : (gameState.tribe === 'Roman' ? 'Romalılar' : 'Cermenler');
        
        let now = Date.now();
        let diffSec = Math.floor((now - gameState.lastUpdate) / 1000);
        if(diffSec > 0) calculateOfflineProduction(diffSec);
        
        drawMaps();
        gameLoop = setInterval(updateEngine, 1000);
    }

    /* ================= ÇİZİM FONKSİYONLARI ================= */
    function drawMaps() {
        const map1 = document.getElementById('dorf1-map');
        const map2 = document.getElementById('dorf2-map');
        map1.innerHTML = ''; map2.innerHTML = '';

        // Dorf1 Çiz
        gameState.fields.forEach(f => {
            let layout = dorf1Layout.find(l => l.id === f.id);
            let cls = f.type;
            let html = `<div class="slot ${cls}" style="left:${layout.x}%; top:${layout.y}%;" onclick="openBuildModal(${f.id}, 'field')">
                            ${f.level > 0 ? f.level : ''}
                        </div>`;
            map1.innerHTML += html;
        });

        // Dorf2 Çiz
        gameState.buildings.forEach(b => {
            let layout = dorf2Layout.find(l => l.id === b.id);
            let cls = b.type === 'empty' ? 'empty' : 'building';
            if(b.type === 'center') cls = 'building main-building';
            let html = `<div class="slot ${cls}" style="left:${layout.x}%; top:${layout.y}%;" onclick="openBuildModal(${b.id}, 'building')">
                            ${b.level > 0 ? b.level : '+'}
                        </div>`;
            map2.innerHTML += html;
        });
    }

    /* ================= MODAL (İnşaat Ekranı) ================= */
    function openBuildModal(id, mapType) {
        selectedSlotId = id;
        const modalBody = document.getElementById('buildModalBody');
        let item = mapType === 'field' ? gameState.fields.find(f => f.id === id) : gameState.buildings.find(b => b.id === id);
        
        let info = buildingInfo;

        if (item.type !== 'empty') {
            // MEVCUT BİNA YÜKSELTME EKRANI (Attığın HTML'in Modern Hali)
            let nextLevel = item.level + 1;
            let cost = info.cost.map(c => Math.floor(c * Math.pow(1.2, item.level)));
            let time = Math.floor(info.time * Math.pow(1.1, item.level));

            modalBody.innerHTML = `
                <div class="row align-items-center mb-3 border-bottom pb-3">
                    <div class="col-8">
                        <h4 class="text-primary">${info.name} <span class="badge bg-secondary fs-6">Seviye ${item.level}</span></h4>
                        <p class="text-muted small">${info.desc || 'Hammadde üretir. Seviyesi arttıkça üretim artar.'}</p>
                    </div>
                </div>
                
                <h6 class="fw-bold">Geliştirme Masrafları (Seviye ${nextLevel}):</h6>
                <div class="d-flex justify-content-between bg-light p-3 rounded mb-3 border">
                    <div><i class="bi bi-tree-fill text-success"></i> ${cost}</div>
                    <div><i class="bi bi-bricks text-danger"></i> ${cost}</div>
                    <div><i class="bi bi-nut-fill text-secondary"></i> ${cost}</div>
                    <div><i class="bi bi-flower1 text-warning"></i> ${cost}</div>
                    <div><i class="bi bi-clock"></i> ${time} sn</div>
                </div>
                
                <div class="text-center">
                    <button class="btn btn-success btn-lg px-5 fw-bold" onclick="issueBuildCommand(${id}, '${item.type}', ${cost}, ${cost}, ${cost}, ${cost}, ${time})">
                        <i class="bi bi-hammer"></i> Seviye ${nextLevel} Olarak Geliştir
                    </button>
                </div>
            `;
        } else {
            // BOŞ ALAN - YENİ BİNA DİKME EKRANI
            let options =;
            let html = '<h5 class="mb-3">Yeni Bina İnşa Et</h5><div class="list-group">';
            
            options.forEach(type => {
                let inf = buildingInfo;
                html += `
                <div class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="mb-1 text-primary fw-bold">${inf.name}</h6>
                        <small class="text-muted">${inf.desc}</small>
                        <div class="d-flex gap-2 mt-1 small">
                            <span class="text-success"><i class="bi bi-tree-fill"></i> ${inf.cost}</span>
                            <span class="text-danger"><i class="bi bi-bricks"></i> ${inf.cost}</span>
                            <span class="text-secondary"><i class="bi bi-nut-fill"></i> ${inf.cost}</span>
                            <span class="text-warning"><i class="bi bi-flower1"></i> ${inf.cost}</span>
                        </div>
                    </div>
                    <button class="btn btn-outline-success" onclick="issueBuildCommand(${id}, '${type}', ${inf.cost}, ${inf.cost}, ${inf.cost}, ${inf.cost}, ${inf.time})">İnşa Et</button>
                </div>`;
            });
            html += '</div>';
            modalBody.innerHTML = html;
        }

        new bootstrap.Modal(document.getElementById('buildModal')).show();
    }

    function issueBuildCommand(id, type, cw, cc, ci, cr, time) {
        if (gameState.resources.wood < cw || gameState.resources.clay < cc || gameState.resources.iron < ci || gameState.resources.crop < cr) {
            alert("Yetersiz Hammadde!"); return;
        }
        
        gameState.resources.wood -= cw;
        gameState.resources.clay -= cc;
        gameState.resources.iron -= ci;
        gameState.resources.crop -= cr;

        let bName = buildingInfo.name;
        let isField =.includes(type);

        gameState.buildQueue.push({
            qId: Date.now(), targetId: id, type: type, name: bName, isField: isField, timeLeft: time
        });

        bootstrap.Modal.getInstance(document.getElementById('buildModal')).hide();
        updateUI();
    }

    /* ================= OYUN MOTORU (HER SANİYE) ================= */
    function updateEngine() {
        let now = Date.now();
        
        // 1. Üretim (10x Server -> Saatte 1000 base. Seviye * 100 ekle)
        let boost = (gameState.prodBoostUntil > now) ? 1.25 : 1;
        
        let prods = { wood: 50, clay: 50, iron: 50, crop: 50 }; // Base (10x Server base)
        
        gameState.fields.forEach(f => {
            if(f.level > 0) prods += (f.level * 150); // Her seviye saatte +150 verir
        });

        // Saniyelik Ekleme
        gameState.resources.wood += (prods.wood * boost) / 3600;
        gameState.resources.clay += (prods.clay * boost) / 3600;
        gameState.resources.iron += (prods.iron * boost) / 3600;
        gameState.resources.crop += (prods.crop * boost) / 3600;

        // UI Üretim Yazılarını Güncelle
        document.getElementById('prod-wood').innerText = Math.floor(prods.wood * boost);
        document.getElementById('prod-clay').innerText = Math.floor(prods.clay * boost);
        document.getElementById('prod-iron').innerText = Math.floor(prods.iron * boost);
        document.getElementById('prod-crop').innerText = Math.floor(prods.crop * boost);

        // 2. İnşaat Kuyruğu (ROMALI KURALI BURADA)
        if (gameState.buildQueue.length > 0) {
            let activeTasks =[];
            
            if (gameState.tribe === 'Roman') {
                let fTask = gameState.buildQueue.find(t => t.isField);
                let bTask = gameState.buildQueue.find(t => !t.isField);
                if (fTask) activeTasks.push(fTask);
                if (bTask) activeTasks.push(bTask);
            } else {
                activeTasks.push(gameState.buildQueue); // Diğerleri 1 tane yapar
            }

            activeTasks.forEach(task => {
                task.timeLeft--;
                if (task.timeLeft <= 0) completeTask(task);
            });
        }

        gameState.lastUpdate = now;
        saveState();
        updateUI();
    }

    function completeTask(task) {
        if (task.isField) {
            let f = gameState.fields.find(x => x.id === task.targetId);
            f.level++;
        } else {
            let b = gameState.buildings.find(x => x.id === task.targetId);
            b.type = task.type; // Empty ise type değişir
            b.level++;
        }
        gameState.population += Math.floor(Math.random() * 3) + 1;
        gameState.buildQueue = gameState.buildQueue.filter(t => t.qId !== task.qId);
        drawMaps();
    }

    function calculateOfflineProduction(seconds) {
        // Çevrimdışı kalınan süreyi hesapla ve toptan ekle (Basit versiyon)
        gameState.resources.wood += (1000 / 3600) * seconds;
        gameState.resources.clay += (1000 / 3600) * seconds;
        gameState.resources.iron += (1000 / 3600) * seconds;
        gameState.resources.crop += (1000 / 3600) * seconds;
    }

    function updateUI() {
        document.getElementById('res-wood').innerText = Math.floor(gameState.resources.wood);
        document.getElementById('res-clay').innerText = Math.floor(gameState.resources.clay);
        document.getElementById('res-iron').innerText = Math.floor(gameState.resources.iron);
        document.getElementById('res-crop').innerText = Math.floor(gameState.resources.crop);
        document.getElementById('population').innerText = gameState.population;

        // Kuyruk UI
        const qBox = document.getElementById('build-queue');
        if (gameState.buildQueue.length === 0) {
            qBox.innerHTML = '<div class="text-muted text-center py-3">Kuyruk boş.</div>';
        } else {
            let html = "";
            gameState.buildQueue.forEach((t, i) => {
                let isActive = false;
                if (gameState.tribe === 'Roman') {
                    if (t === gameState.buildQueue.find(x => x.isField) || t === gameState.buildQueue.find(x => !x.isField)) isActive = true;
                } else {
                    if (i === 0) isActive = true;
                }
                html += `<div class="q-item ${isActive ? 'active' : ''}">
                            <span>${t.name}</span>
                            <span>${isActive ? formatTime(t.timeLeft) : 'Bekliyor'}</span>
                         </div>`;
            });
            qBox.innerHTML = html;
        }
    }

    function formatTime(sec) {
        let m = Math.floor(sec / 60); let s = sec % 60;
        return (m < 10 ? '0'+m : m) + ':' + (s < 10 ? '0'+s : s);
    }

    /* ================= PREMIUM ÖZELLİKLER (ALTIN KULLANIMI) ================= */
    function refreshGold() {
        ydsGold = parseInt(localStorage.getItem('yds_game_gold')) || 0;
        document.getElementById('gold-amount').innerText = ydsGold;
    }

    function useGold(amount) {
        refreshGold();
        if (ydsGold >= amount) {
            ydsGold -= amount;
            localStorage.setItem('yds_game_gold', ydsGold);
            document.getElementById('gold-amount').innerText = ydsGold;
            return true;
        }
        alert("Yeterli YDS Altının yok! Test çözerek altın kazanmalısın.");
        return false;
    }

    // 1. Hemen Bitir
    function instantFinish() {
        if(gameState.buildQueue.length === 0) { alert("Kuyruk boş!"); return; }
        if(useGold(5)) {
            let tasks =;
            tasks.forEach(t => completeTask(t));
        }
    }

    // 2. NPC Tüccar (Eşitle)
    function npcMerchant() {
        if(useGold(3)) {
            let total = gameState.resources.wood + gameState.resources.clay + gameState.resources.iron + gameState.resources.crop;
            let avg = total / 4;
            gameState.resources = { wood: avg, clay: avg, iron: avg, crop: avg };
            updateUI();
        }
    }

    // 3. Üretim Bonusu
    function boostProduction() {
        if(useGold(10)) {
            gameState.prodBoostUntil = Date.now() + (24 * 60 * 60 * 1000); // 24 saat
            alert("%25 Üretim bonusu 24 saatliğine aktif!");
        }
    }

    function saveState() { localStorage.setItem('yds_game_state', JSON.stringify(gameState)); }
</script>
</body>
</html>
